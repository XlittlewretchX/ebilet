"use strict";(self.webpackChunkebilet_client=self.webpackChunkebilet_client||[]).push([[792],{45:(e,n,t)=>{var r=t(848),a=t(540),o=t(338),i=t(976),s=t(767),c=t(468),l=t(816),u=t(83),d=function(e,n,t,r){return new(t||(t=Promise))((function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},f=function(e,n){var t,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(e,o)}catch(e){s=[6,e],r=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},h=u.A.create({baseURL:"https://ebilet-8f91.onrender.com/api",headers:{"Content-Type":"application/json"}});h.interceptors.request.use((function(e){var n=localStorage.getItem("token");return n&&(e.headers.Authorization="Bearer ".concat(n)),e}));var p,v=function(e){return d(void 0,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,h.post("/auth/register",e)];case 1:return[2,n.sent().data]}}))}))},m=function(e){return d(void 0,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,h.post("/auth/login",e)];case 1:return[2,n.sent().data]}}))}))},y=function(e){return d(void 0,void 0,void 0,(function(){var n;return f(this,(function(t){switch(t.label){case 0:return(n=new FormData).append("avatar",e),[4,h.post("/auth/avatar",n,{headers:{"Content-Type":"multipart/form-data"}})];case 1:return[2,t.sent().data]}}))}))},j=function(e){return d(void 0,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,h.patch("/auth/city",{city:e})];case 1:return[2,n.sent().data]}}))}))},x=function(){return d(void 0,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,h.get("/events")];case 1:return[2,e.sent().data]}}))}))},b=function(e){return d(void 0,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,h.get("/events/".concat(e))];case 1:return[2,n.sent().data]}}))}))},g=function(e){return d(void 0,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,h.post("/events",e,{headers:{"Content-Type":"multipart/form-data"}})];case 1:return[2,n.sent().data]}}))}))},w=function(){return d(void 0,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,h.get("/events/user/events")];case 1:return[2,e.sent().data]}}))}))},N=function(e,n,t,r){return new(t||(t=Promise))((function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},k=function(e,n){var t,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(e,o)}catch(e){s=[6,e],r=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},C={user:null,token:localStorage.getItem("token"),isAuthenticated:!1,loading:!1,error:null},P=(0,l.zD)("auth/register",(function(e,n){return N(void 0,[e,n],void 0,(function(e,n){var t,r,a,o=n.rejectWithValue;return k(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,v(e)];case 1:return t=n.sent(),localStorage.setItem("token",t.token),[2,t];case 2:return r=n.sent(),(a=r).response&&a.response.data&&a.response.data.message?[2,o(a.response.data.message)]:[2,o("Ошибка при регистрации")];case 3:return[2]}}))}))})),S=(0,l.zD)("auth/login",(function(e,n){return N(void 0,[e,n],void 0,(function(e,n){var t,r,a,o=n.rejectWithValue;return k(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,m(e)];case 1:return t=n.sent(),localStorage.setItem("token",t.token),[2,t];case 2:return r=n.sent(),(a=r).response&&a.response.data&&a.response.data.message?[2,o(a.response.data.message)]:[2,o("Ошибка при входе")];case 3:return[2]}}))}))})),I=(0,l.zD)("auth/uploadAvatar",(function(e){return N(void 0,void 0,void 0,(function(){return k(this,(function(n){switch(n.label){case 0:return[4,y(e)];case 1:return[2,n.sent()]}}))}))})),O=(0,l.zD)("auth/updateCity",(function(e,n){return N(void 0,[e,n],void 0,(function(e,n){var t=n.rejectWithValue;return k(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,j(e)];case 1:return[2,n.sent().city];case 2:return n.sent(),[2,t("Ошибка при обновлении города")];case 3:return[2]}}))}))})),E=(0,l.Z0)({name:"auth",initialState:C,reducers:{logout:function(e){e.user=null,e.token=null,e.isAuthenticated=!1,localStorage.removeItem("token")},clearError:function(e){e.error=null}},extraReducers:function(e){e.addCase(P.pending,(function(e){e.loading=!0,e.error=null})).addCase(P.fulfilled,(function(e,n){e.loading=!1,e.isAuthenticated=!0,e.user=n.payload.user,e.token=n.payload.token})).addCase(P.rejected,(function(e,n){e.loading=!1,e.error=n.payload||n.error.message||"Ошибка при регистрации"})).addCase(S.pending,(function(e){e.loading=!0,e.error=null})).addCase(S.fulfilled,(function(e,n){e.loading=!1,e.isAuthenticated=!0,e.user=n.payload.user,e.token=n.payload.token})).addCase(S.rejected,(function(e,n){e.loading=!1,e.error=n.payload||n.error.message||"Ошибка при входе"})).addCase(I.fulfilled,(function(e,n){e.user&&(e.user.avatarUrl=n.payload.avatarUrl)})).addCase(O.fulfilled,(function(e,n){e.user&&(e.user.city=n.payload)}))}}),B=(p=E.actions).logout;p.clearError;const R=E.reducer;var A=function(e,n,t,r){return new(t||(t=Promise))((function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},F=function(e,n){var t,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(e,o)}catch(e){s=[6,e],r=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},T=(0,l.zD)("event/fetchEvents",(function(){return A(void 0,void 0,void 0,(function(){return F(this,(function(e){switch(e.label){case 0:return[4,x()];case 1:return[2,e.sent()]}}))}))})),D=((0,l.zD)("event/fetchEventById",(function(e){return A(void 0,void 0,void 0,(function(){return F(this,(function(n){switch(n.label){case 0:return[4,b(e)];case 1:return[2,n.sent()]}}))}))})),(0,l.zD)("event/createEvent",(function(e){return A(void 0,void 0,void 0,(function(){return F(this,(function(n){switch(n.label){case 0:return[4,g(e)];case 1:return[2,n.sent()]}}))}))}))),U=(0,l.zD)("event/fetchUserEvents",(function(){return A(void 0,void 0,void 0,(function(){return F(this,(function(e){switch(e.label){case 0:return[4,w()];case 1:return[2,e.sent()]}}))}))})),z=(0,l.Z0)({name:"event",initialState:{events:[],loading:!1,error:null},reducers:{clearError:function(e){e.error=null}},extraReducers:function(e){e.addCase(T.pending,(function(e){e.loading=!0,e.error=null})).addCase(T.fulfilled,(function(e,n){e.loading=!1,e.events=n.payload})).addCase(T.rejected,(function(e,n){e.loading=!1,e.error=n.error.message||"Ошибка при загрузке событий"})).addCase(D.pending,(function(e){e.loading=!0,e.error=null})).addCase(D.fulfilled,(function(e,n){e.loading=!1,e.events.unshift(n.payload)})).addCase(D.rejected,(function(e,n){e.loading=!1,e.error=n.error.message||"Ошибка при создании события"})).addCase(U.pending,(function(e){e.loading=!0,e.error=null})).addCase(U.fulfilled,(function(e,n){e.loading=!1,e.events=n.payload})).addCase(U.rejected,(function(e,n){e.loading=!1,e.error=n.error.message||"Ошибка при загрузке событий пользователя"}))}});z.actions.clearError;const M=z.reducer;var V,q=function(e,n,t,r){return new(t||(t=Promise))((function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},G=function(e,n){var t,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(e,o)}catch(e){s=[6,e],r=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},Y=(0,l.zD)("city/fetchByIP",(function(e,n){return q(void 0,[e,n],void 0,(function(e,n){var t,r,a,o,i,s,c,l,u,d,f,h,p,v,m,y,j=n.rejectWithValue;return G(this,(function(e){switch(e.label){case 0:return e.trys.push([0,6,,7]),t="90cea4be77d44b80ab21374726d21b70",console.log("[fetchCityByIP] Используемый API-ключ:",t),r="https://api.ipgeolocation.io/ipgeo?apiKey=".concat(t),console.log("[fetchCityByIP] URL запроса:",r),[4,fetch(r)];case 1:return a=e.sent(),console.log("[fetchCityByIP] Статус ответа:",a.status),a.ok?[4,a.json()]:(console.error("[fetchCityByIP] Ошибка API:",a.status),[2,j("Ошибка API: ".concat(a.status))]);case 2:return o=e.sent(),console.log("[fetchCityByIP] Данные от ipgeolocation:",o),i=o.city,s=o.latitude,c=o.longitude,s&&c?(l="https://nominatim.openstreetmap.org/reverse?lat=".concat(s,"&lon=").concat(c,"&format=json&accept-language=ru"),console.log("[fetchCityByIP] URL запроса к Nominatim:",l),[4,fetch(l,{headers:{"User-Agent":"ebilet-app/1.0 (your@email.com)"}})]):(console.warn("[fetchCityByIP] Нет координат, возвращаю город:",i),[2,i||"Город"]);case 3:return u=e.sent(),console.log("[fetchCityByIP] Статус ответа Nominatim:",u.status),u.ok?[4,u.json()]:[3,5];case 4:if(d=e.sent(),console.log("[fetchCityByIP] Данные от Nominatim:",d),f=(null===(p=d.address)||void 0===p?void 0:p.city)||(null===(v=d.address)||void 0===v?void 0:v.town)||(null===(m=d.address)||void 0===m?void 0:m.village)||(null===(y=d.address)||void 0===y?void 0:y.state))return console.log("[fetchCityByIP] Город на русском найден:",f),[2,f];e.label=5;case 5:return console.warn("[fetchCityByIP] Город на русском не найден, возвращаю:",i),[2,i||"Город"];case 6:return h=e.sent(),console.error("[fetchCityByIP] Ошибка:",h),[2,j(h.message)];case 7:return[2]}}))}))})),L=(0,l.Z0)({name:"city",initialState:{name:"Город",showPicker:!1},reducers:{openPicker:function(e){e.showPicker=!0},closePicker:function(e){e.showPicker=!1},setCity:function(e,n){e.name=n.payload,e.showPicker=!1}},extraReducers:function(e){e.addCase(Y.fulfilled,(function(e,n){var t=n.payload;e.name=t,e.showPicker=!1})).addCase(Y.rejected,(function(e){e.showPicker=!0}))}}),X=((V=L.actions).openPicker,V.closePicker,V.setCity);const _=L.reducer;var Z=(0,l.U1)({reducer:{auth:R,event:M,city:_}}),K=function(){return(0,c.wA)()},H=c.d4;const J="bpPJIY6U",W="bjtsBS8k",Q="EDhKdpc7",$="yyzd7YrG",ee="Kjv9kV1L",ne="IAgmSXvg",te="uZZ_BM0m";var re=function(){return re=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},re.apply(this,arguments)},ae=function(e,n,t,r){return new(t||(t=Promise))((function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},oe=function(e,n){var t,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(e,o)}catch(e){s=[6,e],r=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},ie=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)n.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(t[r[a]]=e[r[a]])}return t};const se=function(e){var n=e.isOpen,t=e.onClose,o=K(),i=H((function(e){return e.auth})),s=i.loading,c=i.error,l=i.isAuthenticated,u=H((function(e){return e.city.name})),d=(0,a.useState)(!0),f=d[0],h=d[1],p=(0,a.useState)({username:"",email:"",password:"",confirmPassword:""}),v=p[0],m=p[1],y=(0,a.useState)(""),j=y[0],x=y[1],b=function(e){var n;m(re(re({},v),((n={})[e.target.name]=e.target.value,n)))};return(0,a.useEffect)((function(){n&&l&&f&&t()}),[l,n,f,t]),(0,a.useEffect)((function(){n&&(m({username:"",email:"",password:"",confirmPassword:""}),x(""))}),[n,f]),n?(0,r.jsx)("div",{className:J,onClick:t,children:(0,r.jsxs)("div",{className:W,onClick:function(e){return e.stopPropagation()},children:[(0,r.jsx)("button",{className:Q,onClick:t,children:"×"}),(0,r.jsx)("h2",{children:f?"Вход":"Регистрация"}),(0,r.jsxs)("form",{onSubmit:function(e){return ae(void 0,void 0,void 0,(function(){var n,r,a;return oe(this,(function(i){switch(i.label){case 0:return e.preventDefault(),f||v.password===v.confirmPassword?f?(v.email,v.confirmPassword,n=ie(v,["email","confirmPassword"]),[4,o(S(n))]):[3,2]:(alert("Пароли не совпадают"),[2]);case 1:return i.sent(),[3,4];case 2:return v.confirmPassword,r=ie(v,["confirmPassword"]),[4,o(P(re(re({},r),{city:u})))];case 3:a=i.sent(),P.fulfilled.match(a)&&(x("Вы успешно зарегистрировались!"),setTimeout((function(){x(""),t()}),1500)),i.label=4;case 4:return[2]}}))}))},children:[(0,r.jsx)("div",{className:$,children:(0,r.jsx)("input",{type:"text",name:"username",placeholder:"Имя пользователя",value:v.username,onChange:b,required:!0})}),!f&&(0,r.jsx)("div",{className:$,children:(0,r.jsx)("input",{type:"email",name:"email",placeholder:"Email",value:v.email,onChange:b,required:!0})}),(0,r.jsx)("div",{className:$,children:(0,r.jsx)("input",{type:"password",name:"password",placeholder:"Пароль",value:v.password,onChange:b,required:!0})}),!f&&(0,r.jsx)("div",{className:$,children:(0,r.jsx)("input",{type:"password",name:"confirmPassword",placeholder:"Подтвердите пароль",value:v.confirmPassword,onChange:b,required:!0})}),(0,r.jsx)("button",{type:"submit",disabled:s,children:s?"Загрузка...":f?"Войти":"Зарегистрироваться"}),c&&(0,r.jsx)("p",{className:ee,children:c}),j&&(0,r.jsx)("p",{className:ne,children:j})]}),(0,r.jsxs)("p",{className:te,children:[f?"Нет аккаунта?":"Уже есть аккаунт?"," ",(0,r.jsx)("button",{onClick:function(){return h(!f)},children:f?"Зарегистрироваться":"Войти"})]})]})}):null},ce="k5rxhHqu",le="mTFHSVjn",ue="AQj0qjGu",de="NLW9Mru1",fe="JUFDT6sE",he="IecoVAa_",pe="ohMFSmtb",ve="ZykafPsT",me="AMkCxMZ5",ye="eSE1oGM8",je="OQXaY7qu",xe="YpBllFSl",be="zVBLGTS5",ge="BMrkEVHo",we="JtP_ltPL",Ne="rtCQt7XI",ke="kwHSCM5d",Ce="lAVIIIFv",Pe="XapMHCuM",Se="FV9PH3Y9",Ie="YRk2MqKD",Oe="FuZjbqe_",Ee="fA1OvUlR",Be="wwQn_1wS",Re="jXt8BEh2",Ae="X4PUdjG7";var Fe=function(){return(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{marginRight:6},children:(0,r.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z",fill:"#007bff"})})};const Te=function(){var e=K(),n=H((function(e){return e.city})).name,t=H((function(e){return e.auth})),o=t.isAuthenticated,i=t.user,s=(0,a.useState)(!1),c=s[0],l=s[1],u=(0,a.useState)(""),d=u[0],f=u[1],h=o?(null==i?void 0:i.city)||"Город":n;return a.useEffect((function(){f(h)}),[h]),(0,r.jsxs)("div",{className:Se,children:[(0,r.jsxs)("button",{className:Ie,onClick:function(){return l(!0)},"aria-label":"Выбрать город",children:[(0,r.jsx)(Fe,{}),(0,r.jsx)("span",{className:Oe,children:h})]}),c&&(0,r.jsx)("div",{className:Ee,onClick:function(){return l(!1)},children:(0,r.jsxs)("div",{className:Be,onClick:function(e){return e.stopPropagation()},children:[(0,r.jsx)("input",{className:Re,value:d,onChange:function(e){return f(e.target.value)},placeholder:"Введите город",autoFocus:!0}),(0,r.jsxs)("div",{className:Ae,children:[(0,r.jsx)("button",{className:Ce,onClick:function(){d.trim()&&(o?(e(O(d.trim())),e(X(d.trim()))):e(X(d.trim())),l(!1))},children:"Сохранить"}),(0,r.jsx)("button",{className:Pe,onClick:function(){return l(!1)},children:"Отмена"})]})]})})]})};const De=function(){var e,n=K(),t=H((function(e){return e.auth})),o=t.user,s=t.isAuthenticated,c=(0,a.useState)(!1),l=c[0],u=c[1],d=(0,a.useState)(!1),f=d[0],h=d[1],p=(0,a.useState)(!1),v=p[0],m=p[1],y=(0,a.useState)(""),j=y[0],x=y[1];(0,a.useEffect)((function(){s?(null==o?void 0:o.city)&&"Город"!==o.city?n(X(o.city)):n(Y()).then((function(e){Y.fulfilled.match(e)&&(n(O(e.payload)),n(X(e.payload)))})):n(Y()).then((function(e){Y.fulfilled.match(e)&&n(X(e.payload))}))}),[s]);return(0,a.useEffect)((function(){if(f){var e=function(e){var n=document.getElementById("user-menu-dropdown");n&&!n.contains(e.target)&&(h(!1),m(!1))};return document.addEventListener("mousedown",e),function(){return document.removeEventListener("mousedown",e)}}}),[f]),(0,r.jsxs)("header",{className:ce,children:[(0,r.jsxs)("div",{className:le,children:[(0,r.jsx)(i.N_,{to:"/",className:ue,children:"EBilet"}),(0,r.jsx)("div",{className:pe,children:(0,r.jsx)("input",{type:"text",placeholder:"Поиск мероприятий...",value:j,onChange:function(e){return x(e.target.value)}})}),(0,r.jsxs)("nav",{className:de,children:[(0,r.jsx)(Te,{}),s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.N_,{to:"/my-tickets",className:fe,children:"Мои события"}),(0,r.jsxs)("div",{className:ve,children:[(0,r.jsxs)("button",{className:me+(f?" "+ye:""),onClick:function(){h((function(e){return!e})),m(!1)},"aria-haspopup":"true","aria-expanded":f,children:[(0,r.jsx)("img",{src:(null==o?void 0:o.avatarUrl)?o.avatarUrl.startsWith("/uploads")?"".concat(null===(e="https://ebilet-8f91.onrender.com/api")?void 0:e.replace("/api","")).concat(o.avatarUrl):o.avatarUrl:"/img/default-avatar.svg",alt:"avatar",className:je}),(0,r.jsx)("span",{className:xe,children:null==o?void 0:o.username})]}),f&&(0,r.jsxs)("div",{className:be,id:"user-menu-dropdown",children:[(0,r.jsx)(i.N_,{className:ge,to:"/profile",onClick:function(){return h(!1)},children:"Мой профиль"}),(0,r.jsx)("div",{className:we}),v?(0,r.jsxs)("div",{className:Ne,children:["Выйти из аккаунта?",(0,r.jsxs)("div",{className:ke,children:[(0,r.jsx)("button",{className:Ce,onClick:function(){n(B()),m(!1),h(!1)},children:"Да"}),(0,r.jsx)("button",{className:Pe,onClick:function(){return m(!1)},children:"Нет"})]})]}):(0,r.jsx)("button",{className:ge,onClick:function(){return m(!0)},children:"Выйти"})]})]})]}):(0,r.jsx)("button",{onClick:function(){return u(!0)},className:he,children:"Войти"})]})]}),(0,r.jsx)(se,{isOpen:l,onClose:function(){return u(!1)}})]})},Ue="YvM5FLFP",ze="dXj11BDJ",Me="FpY8onfk",Ve="CRizw7lr",qe="QgcL77oZ",Ge="RRM3pxoO",Ye="zu3mJbnV",Le="JYaCMsI8",Xe="TTVw5vFO",_e="mXBkGq1O",Ze="AOIpO0MI",Ke="cPHSjKlo",He="C4vpFgDJ";const Je=function(e){var n,t=e.event,a=e.onAddToFavorites,o=e.onBuyTicket;return(0,r.jsxs)("div",{className:Ue,children:[t.imageUrl&&(0,r.jsx)("div",{className:ze,children:(0,r.jsx)("img",{src:t.imageUrl,alt:t.title,className:Me})}),(0,r.jsxs)("div",{className:Ve,children:[(0,r.jsx)("h3",{className:qe,children:t.title}),(0,r.jsx)("p",{className:Ge,children:t.description}),(0,r.jsxs)("div",{className:Ye,children:[(0,r.jsx)("span",{className:Le,children:(n=t.date,new Date(n).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"}))}),(0,r.jsx)("span",{className:Xe,children:t.location}),(0,r.jsxs)("span",{className:_e,children:[t.price," ₽"]})]}),(0,r.jsxs)("div",{className:Ze,children:[(0,r.jsx)("button",{className:Ke,onClick:function(){return a(t.id)},children:"В избранное"}),(0,r.jsx)("button",{className:He,onClick:function(){return o(t.id)},children:"Купить билет"})]})]})]})},We="PjgZ7vFV",Qe="jaY9VeYu",$e="BaGs2vBz",en="YvBg03zK",nn="Tlk30F4G",tn="J481YSQ9",rn="e9XMvyD5",an="b9FCLRCd";var on=function(){return on=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},on.apply(this,arguments)};const sn=function(e){var n=e.onFilterChange,t=(0,a.useState)({category:"",dateRange:{start:"",end:""},priceRange:{min:0,max:1e4}}),o=t[0],i=t[1],s=function(e,t){var r,a=on(on({},o),((r={})[e]=t,r));i(a),null==n||n(a)};return(0,r.jsxs)("div",{className:We,children:[(0,r.jsx)("h3",{className:Qe,children:"Фильтры"}),(0,r.jsxs)("div",{className:$e,children:[(0,r.jsx)("label",{className:en,children:"Категория"}),(0,r.jsxs)("select",{className:nn,value:o.category,onChange:function(e){return s("category",e.target.value)},children:[(0,r.jsx)("option",{value:"",children:"Все категории"}),(0,r.jsx)("option",{value:"concert",children:"Концерты"}),(0,r.jsx)("option",{value:"theater",children:"Театр"}),(0,r.jsx)("option",{value:"exhibition",children:"Выставки"}),(0,r.jsx)("option",{value:"sport",children:"Спорт"})]})]}),(0,r.jsxs)("div",{className:$e,children:[(0,r.jsx)("label",{className:en,children:"Дата"}),(0,r.jsx)("div",{className:rn,children:(0,r.jsx)("input",{type:"date",className:tn,value:o.dateRange.start,onChange:function(e){return s("dateRange",on(on({},o.dateRange),{start:e.target.value}))}})})]}),(0,r.jsxs)("div",{className:$e,children:[(0,r.jsx)("label",{className:en,children:"Цена"}),(0,r.jsxs)("div",{className:an,children:[(0,r.jsx)("input",{type:"number",className:tn,placeholder:"От",value:o.priceRange.min,onChange:function(e){return s("priceRange",on(on({},o.priceRange),{min:Number(e.target.value)}))}}),(0,r.jsx)("input",{type:"number",className:tn,placeholder:"До",value:o.priceRange.max,onChange:function(e){return s("priceRange",on(on({},o.priceRange),{max:Number(e.target.value)}))}})]})]})]})},cn="CgjxyfEd",ln="RLut3f27",un="slcXbDY8",dn="zRDTHKjp",fn="UD6lwGa_",hn="oAFdJnbK",pn="GUOZxmDe";const vn=function(){var e=K(),n=H((function(e){return e.event})),t=n.events,o=n.loading,i=n.error;(0,a.useEffect)((function(){e(T())}),[e]);var s=function(e){console.log("Добавлено в избранное: ".concat(e))},c=function(e){console.log("Куплен билет: ".concat(e))};return o?(0,r.jsx)("div",{className:hn,children:"Загрузка..."}):i?(0,r.jsxs)("div",{className:pn,children:["Ошибка: ",i]}):(0,r.jsx)("div",{className:cn,children:(0,r.jsxs)("div",{className:ln,children:[(0,r.jsx)("aside",{className:un,children:(0,r.jsx)(sn,{onFilterChange:function(e){console.log("Фильтры:",e)}})}),(0,r.jsx)("main",{className:dn,children:(0,r.jsx)("div",{className:fn,children:t.map((function(e){return(0,r.jsx)(Je,{event:e,onAddToFavorites:s,onBuyTicket:c},e.id)}))})})]})})},mn="Crw2kdr1",yn="C39kYaHZ",jn="nN4bYVhl",xn="KAiSm_v9",bn="KJlTLrGi",gn="_RzXGQFk",wn="cZJTIiqp",Nn="EJOHFjYL",kn="EbW2xjXI",Cn="EXuRoKnY",Pn="uXDX9P80",Sn="uHtTRs6c",In="SeuQM5i6",On="sudOS0eV",En="DzmiSDRR",Bn="ZW_on0Wd",Rn="cnbyq8qV";var An=function(){return An=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},An.apply(this,arguments)},Fn=function(e,n,t,r){return new(t||(t=Promise))((function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},Tn=function(e,n){var t,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(e,o)}catch(e){s=[6,e],r=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};const Dn=function(){var e,n=K(),t=H((function(e){return e.auth})).user,o=H((function(e){return e.event})),i=o.events,s=o.loading,c=o.error,l=(0,a.useState)(!1),u=l[0],d=l[1],f=(0,a.useState)({username:(null==t?void 0:t.username)||"",email:(null==t?void 0:t.email)||"",city:(null==t?void 0:t.city)||""}),h=f[0],p=f[1];(0,a.useEffect)((function(){t&&n(U())}),[n,t]);var v=function(e){var n;p(An(An({},h),((n={})[e.target.name]=e.target.value,n)))};return t?s?(0,r.jsx)("div",{className:Bn,children:"Загрузка..."}):c?(0,r.jsx)("div",{className:Rn,children:c}):(0,r.jsx)("div",{className:mn,children:(0,r.jsxs)("div",{className:yn,children:[(0,r.jsxs)("div",{className:jn,children:[(0,r.jsxs)("div",{className:xn,children:[(0,r.jsx)("img",{src:t.avatarUrl?t.avatarUrl.startsWith("/uploads")?"".concat(null===(e="https://ebilet-8f91.onrender.com/api")?void 0:e.replace("/api","")).concat(t.avatarUrl):t.avatarUrl:"/img/default-avatar.svg",alt:"Avatar",className:bn}),(0,r.jsxs)("label",{className:gn,children:["Изменить фото",(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:function(e){return Fn(void 0,void 0,void 0,(function(){var t,r;return Tn(this,(function(a){switch(a.label){case 0:return(t=null===(r=e.target.files)||void 0===r?void 0:r[0])?[4,n(I(t))]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))},style:{display:"none"}})]})]}),(0,r.jsx)("div",{className:wn,children:u?(0,r.jsxs)("form",{className:Nn,children:[(0,r.jsxs)("div",{className:kn,children:[(0,r.jsx)("label",{children:"Имя пользователя"}),(0,r.jsx)("input",{type:"text",name:"username",value:h.username,onChange:v})]}),(0,r.jsxs)("div",{className:kn,children:[(0,r.jsx)("label",{children:"Email"}),(0,r.jsx)("input",{type:"email",name:"email",value:h.email,onChange:v})]}),(0,r.jsxs)("div",{className:kn,children:[(0,r.jsx)("label",{children:"Город"}),(0,r.jsx)("input",{type:"text",name:"city",value:h.city,onChange:v})]}),(0,r.jsxs)("div",{className:Cn,children:[(0,r.jsx)("button",{type:"submit",className:Sn,children:"Сохранить"}),(0,r.jsx)("button",{type:"button",className:In,onClick:function(){return d(!1)},children:"Отмена"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{children:t.username}),(0,r.jsx)("p",{children:t.email}),(0,r.jsx)("p",{children:t.city}),(0,r.jsx)("button",{className:Pn,onClick:function(){return d(!0)},children:"Редактировать профиль"})]})})]}),(0,r.jsxs)("div",{className:On,children:[(0,r.jsx)("h3",{children:"Мои события"}),(0,r.jsx)("div",{className:En,children:i.map((function(e){return(0,r.jsx)(Je,{event:e,onAddToFavorites:function(){},onBuyTicket:function(){}},e.id)}))})]})]})}):(0,r.jsx)("div",{className:Rn,children:"Пожалуйста, войдите в систему"})},Un="_ifCH7uh";const zn=function(){return(0,r.jsxs)("div",{className:Un,children:[(0,r.jsx)("h1",{children:"Мои события"}),(0,r.jsx)("p",{children:"Здесь будут отображаться все купленные билеты пользователя на события."})]})},Mn="d6WLOcTu",Vn="CjyF501h";const qn=function(){return(0,r.jsx)(c.Kq,{store:Z,children:(0,r.jsx)(i.Kd,{basename:"/ebilet",children:(0,r.jsxs)("div",{className:Mn,children:[(0,r.jsx)(De,{}),(0,r.jsx)("main",{className:Vn,children:(0,r.jsxs)(s.BV,{children:[(0,r.jsx)(s.qh,{path:"/",element:(0,r.jsx)(vn,{})}),(0,r.jsx)(s.qh,{path:"/profile",element:(0,r.jsx)(Dn,{})}),(0,r.jsx)(s.qh,{path:"/my-tickets",element:(0,r.jsx)(zn,{})})]})})]})})})};o.createRoot(document.getElementById("root")).render((0,r.jsx)(a.StrictMode,{children:(0,r.jsx)(qn,{})}))}},e=>{e.O(0,[460],(()=>{return n=45,e(e.s=n);var n}));e.O()}]);
//# sourceMappingURL=main.6a1f4e36.js.map